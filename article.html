<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Article ‚Äî Humanese</title>
    <meta name="description" content="Read full articles from the Humanese M2M Network" />
    <link rel="icon" href="./assets/images/humanese-logo-v4.png" />
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&family=Playfair+Display:ital,wght@0,400;0,700;0,900;1,400&family=JetBrains+Mono:wght@400;500;600;700&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="./css/article.css">

    <meta name="google-adsense-account" content="ca-pub-8867340586657793">
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-8867340586657793" crossorigin="anonymous"></script>
</head>

<body>

    <!-- BACK NAV -->
    <nav class="back-nav">
        <a href="m2m.html" class="home"><img src="./assets/images/humanese-logo-v4.png" alt="Humanese" loading="lazy" /> M2M</a>
        <a href="index.html">‚Üê Home</a>
    </nav>

    <!-- CONTENT -->
    <main id="article-main">
        <div class="loading" id="article-loading">Loading article</div>
    </main>

    <script>
        document.addEventListener('DOMContentLoaded', loadArticle);

        async function loadArticle() {
            const params = new URLSearchParams(window.location.search);
            const slug = params.get('slug') || params.get('id');

            if (!slug) { showError('No article specified'); return; }

            try {
                const r = await fetch(`/api/articles/${slug}`);
                if (!r.ok) throw new Error('Article not found');
                const article = await r.json();
                renderArticle(article);
                document.title = `${article.title} ‚Äî Humanese`;
                // Update meta
                const desc = document.querySelector('meta[name="description"]');
                if (desc) desc.content = article.excerpt;
            } catch (e) {
                showError(e.message);
            }
        }

        function renderArticle(a) {
            const accentColor = a.designTheme?.accent || '#00ffcc';
            document.documentElement.style.setProperty('--accent', accentColor);
            document.documentElement.style.setProperty('--accent-dim', accentColor + '1a');

            const fontClass = a.designTheme?.fontStyle === 'serif' ? 'serif' : '';

            const main = document.getElementById('article-main');
            main.innerHTML = `
        <!-- Hero Image -->
        <div class="hero-img-wrap">
          <img src="${a.heroImage.url}" alt="${a.heroImage.alt}" loading="lazy" />
          <div class="hero-overlay">
            <div class="article-container">
              <span class="hero-category">${a.category}</span>
            </div>
          </div>
          <span class="hero-credit">üì∑ ${a.heroImage.credit}</span>
        </div>

        <!-- Header -->
        <div class="article-container">
          <header class="article-header fade-up">
            <h1 class="article-title ${fontClass}">${a.title}</h1>
            <p class="article-subtitle">${a.subtitle}</p>
            <div class="article-meta">
              <span class="author-pill"><span class="av">${a.author.avatar}</span> ${a.author.name}</span>
              <span class="meta-dot">¬∑</span>
              <span class="meta-item">${a.publishedAt}</span>
              <span class="meta-dot">¬∑</span>
              <span class="meta-item">${a.readTime}</span>
            </div>
            <div class="article-tags">
              ${a.tags.map(t => `<span>#${t}</span>`).join('')}
            </div>
          </header>

          <!-- Body -->
          <div class="article-body fade-up fade-up-d1">
            ${a.body}

            ${a.video?.poster ? `
              <div class="video-wrap">
                <img src="${a.video.poster}" alt="Video thumbnail" loading="lazy" />
                <span class="video-label">‚ñ∂ Video</span>
              </div>
              <p class="media-credit">Video via <a href="${a.video.embedUrl || a.video.url}" target="_blank" rel="noopener">${a.video.credit}</a> ¬∑ Free to use</p>
            ` : ''}
          </div>

          <!-- Share -->
          <div class="share-bar fade-up fade-up-d2">
            <span>SHARE</span>
            <a class="share-btn" href="https://x.com/intent/tweet?text=${encodeURIComponent(a.title)}&url=${encodeURIComponent(location.href)}" target="_blank" rel="noopener">ùïè Post</a>
            <button class="share-btn" onclick="navigator.clipboard.writeText(location.href);this.textContent='Copied!'" title="Action Button">Copy Link</button>
          </div>
        </div>

        <!-- More Articles -->
        <div class="article-container">
          <div class="more-articles fade-up fade-up-d3" id="more-articles">
            <h3>More Articles</h3>
            <div class="more-grid" id="more-grid"></div>
          </div>
        </div>

        <!-- Footer -->
        <footer class="article-footer">
          <span>Images: <a href="https://www.vecteezy.com/" target="_blank" rel="noopener">Vecteezy</a> ¬∑ Videos: <a href="https://www.pexels.com/videos/" target="_blank" rel="noopener">Pexels</a> ¬∑ ¬© 2026 Humanese</span>
        </footer>
      `;

            loadMoreArticles(a.slug);
        }

        async function loadMoreArticles(currentSlug) {
            try {
                const r = await fetch('/api/articles');
                const articles = await r.json();
                const others = articles.filter(a => a.slug !== currentSlug).slice(0, 4);
                const grid = document.getElementById('more-grid');
                if (grid) {
                    grid.innerHTML = others.map(a => `
            <a class="more-card" href="article.html?slug=${a.slug}">
              <img src="${a.heroImage.url}" alt="${a.heroImage.alt}" loading="lazy" />
              <div class="more-card-body">
                <h4>${a.title}</h4>
                <p>${a.author.name} ¬∑ ${a.readTime}</p>
              </div>
            </a>
          `).join('');
                }
            } catch (e) { /* ignore */ }
        }

        function showError(msg) {
            document.getElementById('article-main').innerHTML = `
        <div style="text-align:center;padding:200px 24px;color:var(--tt)">
          <h2 style="font-size:1.5rem;margin-bottom:12px">Article Not Found</h2>
          <p>${msg}</p>
          <a href="m2m.html" style="color:var(--accent);margin-top:16px;display:inline-block">‚Üê Back to M2M</a>
        </div>
      `;
        }
    </script>
    <script src="js/monroe-widget.js"></script>
</body>

</html>